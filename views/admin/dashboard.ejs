<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/css/admin.css" rel="stylesheet">
</head>
<body>
    <%- include('../partials/admin-sidebar') %>

    <main class="admin-main">
        <%- include('../partials/flash-messages') %>

        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h4 class="fw-bold mb-1">Dashboard</h4>
                <p class="text-muted mb-0">Tổng quan hoạt động kinh doanh</p>
            </div>
            <span class="text-muted"><i class="bi bi-calendar3"></i> <%= new Date().toLocaleDateString('vi-VN') %></span>
        </div>

        <!-- Thẻ thống kê -->
        <div class="row g-3 mb-4">
            <div class="col-md-6 col-xl-3">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-label">Tổng doanh thu</div>
                            <div class="stat-value text-success"><%= Number(summary.total_revenue).toLocaleString('vi-VN') %>đ</div>
                        </div>
                        <div class="stat-icon" style="background:rgba(16,185,129,0.15);color:#10b981"><i class="bi bi-currency-dollar"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-xl-3">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-label">Chi phí hàng</div>
                            <div class="stat-value text-warning"><%= Number(summary.total_cost).toLocaleString('vi-VN') %>đ</div>
                        </div>
                        <div class="stat-icon" style="background:rgba(245,158,11,0.15);color:#f59e0b"><i class="bi bi-wallet2"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-xl-3">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-label">Lợi nhuận gộp</div>
                            <div class="stat-value" style="color:#a855f7"><%= Number(summary.total_profit).toLocaleString('vi-VN') %>đ</div>
                        </div>
                        <div class="stat-icon" style="background:rgba(168,85,247,0.15);color:#a855f7"><i class="bi bi-graph-up-arrow"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-xl-3">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-label">Tổng đơn hàng</div>
                            <div class="stat-value text-info"><%= summary.total_orders %></div>
                            <small class="text-muted">Hôm nay: <strong><%= todayCount %></strong></small>
                        </div>
                        <div class="stat-icon" style="background:rgba(59,130,246,0.15);color:#3b82f6"><i class="bi bi-receipt"></i></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Thẻ chi phí cố định và lợi nhuận ròng (tháng này) -->
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-label">Chi phí cố định (tháng này)</div>
                            <div class="stat-value text-danger"><%= Number(fixedCostsTotal).toLocaleString('vi-VN') %>đ</div>
                        </div>
                        <div class="stat-icon" style="background:rgba(239,68,68,0.15);color:#ef4444"><i class="bi bi-cash-stack"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-label">Lợi nhuận ròng (tháng này)</div>
                            <div class="stat-value" style="color:#10b981"><%= Number(netProfit).toLocaleString('vi-VN') %>đ</div>
                            <small class="text-muted">= LN gộp - Chi phí cố định</small>
                        </div>
                        <div class="stat-icon" style="background:rgba(16,185,129,0.15);color:#10b981"><i class="bi bi-trophy"></i></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Biểu đồ 7 ngày -->
        <div class="chart-container">
            <h6 class="fw-bold mb-3"><i class="bi bi-bar-chart-line me-2"></i>Doanh thu & Lợi nhuận 7 ngày qua</h6>
            <canvas id="revenueChart" height="100"></canvas>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        const chartData = <%- JSON.stringify(chartData) %>;
        const ctx = document.getElementById('revenueChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: chartData.map(d => d.label),
                datasets: [
                    {
                        label: 'Doanh thu',
                        data: chartData.map(d => d.revenue),
                        backgroundColor: 'rgba(16,185,129,0.6)',
                        borderColor: '#10b981',
                        borderWidth: 1, borderRadius: 6
                    },
                    {
                        label: 'Lợi nhuận',
                        data: chartData.map(d => d.profit),
                        backgroundColor: 'rgba(168,85,247,0.6)',
                        borderColor: '#a855f7',
                        borderWidth: 1, borderRadius: 6
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { labels: { color: '#94a3b8', font: { size: 13 }} },
                    tooltip: {
                        callbacks: {
                            label: ctx => ctx.dataset.label + ': ' + Number(ctx.raw).toLocaleString('vi-VN') + 'đ'
                        }
                    }
                },
                scales: {
                    x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' }},
                    y: {
                        ticks: { color: '#94a3b8', callback: v => (v/1000) + 'k' },
                        grid: { color: 'rgba(255,255,255,0.05)' }
                    }
                }
            }
        });
    </script>
</body>
</html>

